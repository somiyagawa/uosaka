<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal Dependencyの世界へ - UD入門</title>
    <style>
        /* Google Fonts & System Fonts */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&family=Noto+Sans+JP:wght@400;500;700;900&display=swap');
        
        :root {
            --font-primary: "Inter", "Noto Sans JP", sans-serif;
            --color-primary: #3b82f6;
            --color-secondary: #8b5cf6;
            --color-accent: #f59e0b;
            --color-success: #10b981;
            --color-danger: #ef4444;
            --color-text-primary: #1e293b;
            --color-text-secondary: #475569;
            --color-bg: #f8fafc;
            --color-bg-card: #ffffff;
            --color-border: #e2e8f0;
        }
        
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: var(--font-primary);
            background: var(--color-bg);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        .slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--color-bg);
            padding: 60px 80px;
            overflow-y: auto;
            color: var(--color-text-primary);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.6s cubic-bezier(0.4, 0, 0.2, 1), transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            transform: translateX(100%);
        }
        
        .slide.active { opacity: 1; visibility: visible; z-index: 1; transform: translateX(0); }
        .slide.prev-slide { transform: translateX(-100%); }

        .title-slide {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        
        .title-slide h1 {
            font-size: clamp(3rem, 6vw, 5rem);
            font-weight: 900;
            letter-spacing: -0.02em;
            color: white;
            text-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        .title-slide .subtitle {
            font-size: clamp(1.25rem, 2vw, 1.75rem);
            font-weight: 400;
            color: rgba(255,255,255,0.95);
            max-width: 700px;
            margin-top: 1.5rem;
            text-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        .title-slide .author-info {
            margin-top: 3rem;
            font-size: 1.2rem;
            color: rgba(255,255,255,0.85);
        }
        
        h1, h2, h3 { font-weight: 900; letter-spacing: -0.01em; }
        h2 { font-size: 2.5rem; margin-bottom: 2rem; border-bottom: 3px solid var(--color-primary); padding-bottom: 1rem; }
        h3 { font-size: 1.8rem; margin-bottom: 1.5rem; font-weight: 700; color: var(--color-text-primary); }
        
        p, li { font-size: 1.25rem; line-height: 1.8; color: var(--color-text-secondary); margin-bottom: 1rem; }
        
        .card {
            background: var(--color-bg-card);
            padding: 2rem;
            border-radius: 20px;
            margin: 2rem 0;
            border: 1px solid var(--color-border);
            box-shadow: 0 10px 30px rgba(0,0,0,0.07);
        }
        
        .highlight-card {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            border-left: 5px solid var(--color-accent);
            padding: 2rem;
            border-radius: 20px;
            margin: 2rem 0;
        }
        
        .tree-container {
            background: var(--color-bg-card);
            padding: 2rem;
            border-radius: 20px;
            margin: 1rem 0;
            border: 1px solid var(--color-border);
        }
        
        svg.dependency-tree {
            width: 100%;
            max-width: 900px;
            display: block;
            margin: 1.5rem auto;
            font-family: var(--font-primary);
        }
        .dep-word { font-size: 1.2rem; font-weight: 700; fill: var(--color-text-primary); }
        .dep-pos { font-size: 0.85rem; fill: #64748b; }
        .dep-arrow { stroke-width: 2.5; fill: none; }
        .dep-label { font-size: 0.9rem; font-weight: 700; }
        
        .dep-nsubj { stroke: var(--color-primary); } .dep-nsubj-label { fill: var(--color-primary); }
        .dep-obj { stroke: var(--color-success); } .dep-obj-label { fill: var(--color-success); }
        .dep-iobj { stroke: var(--color-secondary); } .dep-iobj-label { fill: var(--color-secondary); }
        .dep-mod { stroke: var(--color-accent); } .dep-mod-label { fill: var(--color-accent); }
        .dep-case { stroke: #94a3b8; } .dep-case-label { fill: #94a3b8; }

        .navigation-controls { display: flex; position: fixed; bottom: 30px; right: 30px; z-index: 10; gap: 1rem; }
        .nav-button {
            width: 55px; height: 55px; border-radius: 50%;
            border: none;
            background: white;
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
            color: var(--color-text-secondary);
            font-size: 1.5rem; cursor: pointer;
            transition: all 0.2s ease;
        }
        .nav-button:hover { transform: translateY(-3px) scale(1.05); box-shadow: 0 8px 25px rgba(0,0,0,0.2); }
        .nav-button:disabled { opacity: 0.5; transform: scale(1); cursor: not-allowed; box-shadow: 0 5px 20px rgba(0,0,0,0.15); }

        .gemini-button {
            display: inline-flex; align-items: center; gap: 0.75rem;
            background: linear-gradient(135deg, var(--color-primary), var(--color-secondary));
            color: white; padding: 0.8rem 1.6rem;
            border-radius: 99px; font-weight: 700; font-size: 1rem;
            border: none; cursor: pointer; transition: all 0.3s ease;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }
        .gemini-button:hover { transform: translateY(-3px); box-shadow: 0 8px 25px rgba(102, 126, 234, 0.5); }
        .gemini-button:disabled { background: #9ca3af; color: #e5e7eb; cursor: not-allowed; transform: none; box-shadow: none; }
        
        .ui-overlay {
            position: fixed; z-index: 5; color: #6b7280;
            background: rgba(255,255,255,0.8); padding: 0.5rem 1rem;
            border-radius: 99px; backdrop-filter: blur(10px);
            border: 1px solid var(--color-border);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        #slide-counter { top: 30px; right: 30px; }
        #progress-bar { bottom: 0; left: 0; width: 100%; height: 8px; background: transparent; z-index: 11;}
        #progress-fill { height: 100%; background: linear-gradient(90deg, var(--color-primary), var(--color-secondary)); width: 0%; transition: width 0.3s ease;}
        
        table.styled-table {
            width: 100%;
            border-collapse: collapse;
            margin: 2rem 0;
            font-size: 1.1rem;
        }
        .styled-table th, .styled-table td {
            border: 1px solid var(--color-border);
            padding: 12px 15px;
            text-align: left;
        }
        .styled-table th {
            background-color: var(--color-bg);
            font-weight: 700;
        }
        .styled-table tr:nth-of-type(even) {
            background-color: #fcfcfd;
        }
        code {
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;
            background: #eef2ff;
            color: #4338ca;
            padding: 0.2em 0.4em;
            border-radius: 4px;
            font-size: 0.9em;
        }
        pre code {
            display: block;
            padding: 1rem;
            border-radius: 8px;
            background: var(--color-text-primary);
            color: #e0e0e0;
            white-space: pre-wrap;
            word-break: break-all;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
</head>
<body>

    <div id="slide-counter" class="ui-overlay"><span id="current-slide-num">1</span> / <span id="total-slides-num">1</span></div>
    <div id="progress-bar"><div id="progress-fill"></div></div>
    <div class="navigation-controls">
        <button id="prev-btn" class="nav-button"><i class="fas fa-arrow-left"></i></button>
        <button id="next-btn" class="nav-button"><i class="fas fa-arrow-right"></i></button>
    </div>

    <!-- SVG Definitions for Arrows -->
    <svg style="width:0;height:0;position:absolute;">
      <defs>
        <marker id="arrow-nsubj" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse"><path d="M 0 0 L 10 5 L 0 10 z" fill="var(--color-primary)"/></marker>
        <marker id="arrow-obj" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse"><path d="M 0 0 L 10 5 L 0 10 z" fill="var(--color-success)"/></marker>
        <marker id="arrow-iobj" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse"><path d="M 0 0 L 10 5 L 0 10 z" fill="var(--color-secondary)"/></marker>
        <marker id="arrow-mod" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse"><path d="M 0 0 L 10 5 L 0 10 z" fill="var(--color-accent)"/></marker>
        <marker id="arrow-case" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse"><path d="M 0 0 L 10 5 L 0 10 z" fill="#94a3b8"/></marker>
      </defs>
    </svg>

    <div id="slide-container">
        <div class="slide active title-slide">
             <h1>Universal Dependencies (UD) <br>の世界へ</h1>
          
                <h2>宮川 創 (筑波大学)</ｈ2>
                <h3>2025年6月10日 大阪大学</h3>
            </div>
        </div>

        <div class="slide">
            <h2>本日の内容（だいたい））</h2>
            <div class="card">
                <ol class="space-y-3 text-lg" style="list-style: none; padding-left: 0;">
                    <li><span style="color:var(--color-primary); margin-right: 1rem; font-weight:bold;">1.</span>UDとは何か：統語樹の紹介</li>
                    <li><span style="color:var(--color-primary); margin-right: 1rem; font-weight:bold;">2.</span>UDの構成要素と応用</li>
                    <li><span style="color:var(--color-primary); margin-right: 1rem; font-weight:bold;">3.</span>言語の形：形態論的類型論</li>
                    <li><span style="color:var(--color-primary); margin-right: 1rem; font-weight:bold;">4.</span>世界の語順：基本語順類型論</li>
                    <li><span style="color:var(--color-primary); margin-right: 1rem; font-weight:bold;">5.</span>統語樹の実例（日本語）</li>
                    <li><span style="color:var(--color-primary); margin-right: 1rem; font-weight:bold;">6.</span>統語樹の実例（多言語比較）</li>
                    <li><span style="color:var(--color-primary); margin-right: 1rem; font-weight:bold;">7.</span>研究例：危機言語と古代言語</li>
                    <li><span style="color:var(--color-primary); margin-right: 1rem; font-weight:bold;">8.</span>便利なツール</li>
                    <li><span style="color:var(--color-secondary); margin-right: 1rem; font-weight:bold;">9.</span><strong style="color:var(--color-text-primary)">AIと創る研究テーマ</strong></li>
                    <li><span style="color:var(--color-secondary); margin-right: 1rem; font-weight:bold;">10.</span><strong style="color:var(--color-text-primary)">AI構文分析ラボ</strong></li>
                    <li><span style="color:var(--color-secondary); margin-right: 1rem; font-weight:bold;">11.</span><strong style="color:var(--color-text-primary)">AI言語横断ラボ</strong></li>
                </ol>
            </div>
        </div>

        <div class="slide">
            <h2>1-1. UDとは何か：統語樹の紹介</h2>
            <p>Universal Dependencies (UD) は、文の構造を「統語樹」という図で表現します。これにより、一見複雑に見える文も、単語と単語のシンプルな関係に分解して理解できます。</p>
            <div class="tree-container">
                <h3>例：「公園で子供たちが元気に遊んでいる」</h3>
                <svg class="dependency-tree" viewBox="0 0 800 280">
                    <text x="80" y="200" class="dep-word" text-anchor="middle">公園</text>
                    <text x="180" y="200" class="dep-word" text-anchor="middle">で</text>
                    <text x="280" y="200" class="dep-word" text-anchor="middle">子供たち</text>
                    <text x="400" y="200" class="dep-word" text-anchor="middle">が</text>
                    <text x="520" y="200" class="dep-word" text-anchor="middle">元気に</text>
                    <text x="640" y="200" class="dep-word" text-anchor="middle">遊んで</text>
                    <text x="760" y="200" class="dep-word" text-anchor="middle">いる</text>
                    <path d="M 80 185 Q 360 80 630 185" class="dep-arrow dep-mod" marker-end="url(#arrow-mod)"/><text x="360" y="105" class="dep-label dep-mod-label" text-anchor="middle">obl</text>
                    <path d="M 180 185 Q 130 140 90 185" class="dep-arrow dep-case" marker-end="url(#arrow-case)"/><text x="130" y="155" class="dep-label dep-case-label" text-anchor="middle">case</text>
                    <path d="M 280 185 Q 460 40 630 185" class="dep-arrow dep-nsubj" marker-end="url(#arrow-nsubj)"/><text x="460" y="65" class="dep-label dep-nsubj-label" text-anchor="middle">nsubj</text>
                    <path d="M 400 185 Q 340 140 290 185" class="dep-arrow dep-case" marker-end="url(#arrow-case)"/><text x="340" y="155" class="dep-label dep-case-label" text-anchor="middle">case</text>
                    <path d="M 520 185 Q 580 120 630 185" class="dep-arrow dep-mod" marker-end="url(#arrow-mod)"/><text x="580" y="140" class="dep-label dep-mod-label" text-anchor="middle">advmod</text>
                    <path d="M 760 185 Q 700 120 650 185" class="dep-arrow dep-case" marker-end="url(#arrow-case)"/><text x="700" y="140" class="dep-label dep-case-label" text-anchor="middle">aux</text>
                </svg>
            </div>
            <p>この統語樹は、「誰が（<span style="color:var(--color-primary)">子供たちが</span>）」、「どこで（<span style="color:var(--color-accent)">公園で</span>）」、「どのように（<span style="color:var(--color-accent)">元気に</span>）」、「何をしているか（遊んでいる）」という文の骨格を明確に示しています。UDは、このように文の意味の中心となる関係を捉えることができます。</p>
        </div>
         <div class="slide">
            <h2>1. Universal Dependencies (UD) とは？</h2>
            <div class="card">
                <h3>世界共通の文法記述システム</h3>
                <p>UDは、世界中の多様な言語を、統一された方法で文法的に記述するための国際的なプロジェクトです。これにより、言語の壁を越えた客観的な比較分析が可能になります。</p>
            </div>
        </div>
        
        <div class="slide">
            <h2>1-2. UDとは何か：歴史</h2>
             <div class="card">
                <h3>標準化への道のり</h3>
                 <ul class="list-disc list-inside space-y-4">
                     <li><strong>2000年代:</strong> Stanford Dependenciesなど、各研究機関が独自の依存構造解析スキーマを開発。</li>
                     <li><strong>2010年代初頭:</strong> 異なるスキーマ間の互換性の低さが問題となり、標準化の機運が高まる。</li>
                     <li><strong>2014年:</strong> Universal Dependenciesの最初のバージョン(v1)がリリース。複数のプロジェクトが協力し、統一されたアノテーションガイドラインを作成。</li>
                     <li><strong>現在:</strong> 世界中の400人以上の研究者が貢献し、140以上の言語をカバーする巨大プロジェクトへと成長。年2回の定期的なアップデートが行われている。</li>
                 </ul>
            </div>
        </div>

        <div class="slide">
            <h2>1-3. UDとは何か：意義</h2>
             <div class="grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 2rem;">
                 <div class="card">
                    <h3><i class="fas fa-microscope" style="color: var(--color-primary);"></i> 言語学への貢献</h3>
                    <p>異なる言語の文法構造を客観的に比較する「共通の物差し」を提供。言語類型論の研究を加速させます。</p>
                </div>
                 <div class="card">
                    <h3><i class="fas fa-cogs" style="color: var(--color-success);"></i> 自然言語処理(NLP)への貢献</h3>
                    <p>機械翻訳、情報検索、対話システムなどのAI技術の精度向上に不可欠な、高品質な教師データを提供します。</p>
                </div>
                 <div class="card">
                    <h3><i class="fas fa-book-open" style="color: var(--color-secondary);"></i> 教育への貢献</h3>
                    <p>外国語学習者が文の構造を視覚的に理解するのを助け、より深い文法理解を促します。</p>
                </div>
            </div>
        </div>
        
        <div class="slide">
            <h2>1-4. UDとは何か：現在の状況 (UD v2.14)</h2>
            <div class="grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                <div class="card" style="text-align: center;">
                    <p style="font-size: 4rem; font-weight: 900; color: var(--color-primary);">146</p>
                    <h3 style="margin-top: -1rem;">言語</h3>
                </div>
                <div class="card" style="text-align: center;">
                    <p style="font-size: 4rem; font-weight: 900; color: var(--color-secondary);">254</p>
                    <h3 style="margin-top: -1rem;">ツリーバンク</h3>
                </div>
            </div>
            <div class="card">
                <h3><i class="fas fa-globe-americas" style="color: var(--color-success);"></i> 言語の多様性</h3>
                 <p>UDは、英語や中国語のような大規模言語だけでなく、少数言語や危機言語、古代語の記録と分析にも力を入れています。</p>
                 <ul class="list-disc list-inside">
                     <li><strong>古代語の例:</strong> 古代ギリシャ語、ラテン語、ゴート語、古代教会スラブ語</li>
                     <li><strong>少数言語の例:</strong> 北サーミ語（スカンジナビア半島）、ウォロフ語（セネガル）、ブリアート語（シベリア）</li>
                 </ul>
                 <p class="mt-4">これにより、言語の多様性を保護し、人類の文化遺産として後世に伝える重要な役割を担っています。</p>
            </div>
        </div>

        <div class="slide">
            <h2>2-1. UDの応用：言語研究とNLP</h2>
            <div class="grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                <div class="card">
                    <h3>言語研究への応用</h3>
                    <ul class="list-disc list-inside">
                        <li>基本語順 (SOV, SVO等) の大規模な統計調査</li>
                        <li>格表示戦略の言語横断的な比較</li>
                        <li>関係節の構造分析</li>
                    </ul>
                </div>
                 <div class="card">
                    <h3>自然言語処理(NLP)への応用</h3>
                    <ul class="list-disc list-inside">
                        <li>機械翻訳の品質向上</li>
                        <li>情報抽出・関係抽出の精度向上</li>
                        <li>質問応答システムの開発</li>
                        <li>感情分析の高度化</li>
                    </ul>
                </div>
            </div>
        </div>
           <div class="slide">
            <h2>2-2. UDの構成要素と応用</h2>
            <div class="card">
                <h3>UDの3つの柱</h3>
                <p>UDは、主に「品詞タグ」「依存関係ラベル」「CoNLL-Uフォーマット」の3つの要素で構成されています。これらが世界共通の基準として機能することで、多様な言語の分析が可能になります。</p>
            </div>
        </div>

        <div class="slide">
            <h2>3-1. 基本的な統語樹の読み方</h2>
            <div class="tree-container">
                <h3>「猫が寝る」</h3>
                <svg class="dependency-tree" viewBox="0 0 400 200">
                    <text x="100" y="150" class="dep-word" text-anchor="middle">猫</text>
                    <text x="100" y="170" class="dep-pos" text-anchor="middle">NOUN</text>
                    <text x="200" y="150" class="dep-word" text-anchor="middle">が</text>
                    <text x="200" y="170" class="dep-pos" text-anchor="middle">ADP</text>
                    <text x="300" y="150" class="dep-word" text-anchor="middle">寝る</text>
                    <text x="300" y="170" class="dep-pos" text-anchor="middle">VERB</text>
                    <path d="M 100 135 Q 200 70 290 135" class="dep-arrow dep-nsubj" marker-end="url(#arrow-nsubj)"/><text x="200" y="90" class="dep-label dep-nsubj-label" text-anchor="middle">nsubj</text>
                    <path d="M 200 135 Q 150 100 110 135" class="dep-arrow dep-case" marker-end="url(#arrow-case)"/><text x="150" y="115" class="dep-label dep-case-label" text-anchor="middle">case</text>
                </svg>
            </div>
        </div>

        <div class="slide">
            <h2>3-2. 日本語の統語樹：基本から発展へ</h2>
            <div class="tree-container">
                <h3>他動詞: 「私は本を読む」</h3>
                 <svg class="dependency-tree" viewBox="0 0 500 220">
                    <text x="80" y="160" class="dep-word" text-anchor="middle">私</text><text x="80" y="180" class="dep-pos" text-anchor="middle">PRON</text>
                    <text x="260" y="160" class="dep-word" text-anchor="middle">本</text><text x="260" y="180" class="dep-pos" text-anchor="middle">NOUN</text>
                    <text x="440" y="160" class="dep-word" text-anchor="middle">読む</text><text x="440" y="180" class="dep-pos" text-anchor="middle">VERB</text>
                    <path d="M 80 145 Q 260 50 430 145" class="dep-arrow dep-nsubj" marker-end="url(#arrow-nsubj)"/><text x="260" y="75" class="dep-label dep-nsubj-label" text-anchor="middle">nsubj</text>
                    <path d="M 260 145 Q 350 90 430 145" class="dep-arrow dep-obj" marker-end="url(#arrow-obj)"/><text x="350" y="110" class="dep-label dep-obj-label" text-anchor="middle">obj</text>
                </svg>
            </div>
             <div class="tree-container">
                <h3>関係節: 「昨日会った人が本を読んだ」</h3>
                <svg class="dependency-tree" viewBox="0 0 700 280">
                   <text x="80" y="200" class="dep-word" text-anchor="middle">昨日</text>
                   <text x="180" y="200" class="dep-word" text-anchor="middle">会った</text>
                   <text x="280" y="200" class="dep-word" text-anchor="middle">人</text>
                   <text x="460" y="200" class="dep-word" text-anchor="middle">本</text>
                   <text x="640" y="200" class="dep-word" text-anchor="middle">読んだ</text>
                    <path d="M 80 185 Q 130 150 170 185" class="dep-arrow dep-mod" marker-end="url(#arrow-mod)"/><text x="130" y="165" class="dep-label dep-mod-label" text-anchor="middle">obl</text>
                    <path d="M 180 185 Q 230 150 270 185" class="dep-arrow dep-mod" marker-end="url(#arrow-mod)"/><text x="230" y="165" class="dep-label dep-mod-label" text-anchor="middle">acl</text>
                    <path d="M 280 185 Q 460 60 630 185" class="dep-arrow dep-nsubj" marker-end="url(#arrow-nsubj)"/><text x="460" y="90" class="dep-label dep-nsubj-label" text-anchor="middle">nsubj</text>
                    <path d="M 460 185 Q 550 120 630 185" class="dep-arrow dep-obj" marker-end="url(#arrow-obj)"/><text x="550" y="140" class="dep-label dep-obj-label" text-anchor="middle">obj</text>
                    <rect x="50" y="170" width="250" height="60" rx="10" stroke="var(--color-accent)" stroke-dasharray="5,5" stroke-width="2" fill="none"/>
                </svg>
            </div>
        </div>
        
         <div class="slide">
            <h2>4-1. 世界の語順：基本語順類型論</h2>
            <p>文の主要な要素である主語(S)、目的語(O)、動詞(V)がどのような順番で現れるかは、言語の大きな特徴の一つです。</p>
             <div class="card">
                <h3>代表的な語順</h3>
                 <ul class="list-disc list-inside">
                     <li><b>SOV (主語-目的語-動詞):</b> 「猫が 魚を 食べる」 (日本語、韓国語、トルコ語など) - <b style="color:var(--color-primary)">約45%</b></li>
                     <li><b>SVO (主語-動詞-目的語):</b> 「猫は 食べる 魚を」 (英語、中国語、フランス語など) - <b style="color:var(--color-success)">約42%</b></li>
                     <li><b>VSO (動詞-主語-目的語):</b> 「食べる 猫は 魚を」 (アラビア語、アイルランド語など) - <b style="color:var(--color-secondary)">約9%</b></li>
                     <li><b>VOS (動詞-目的語-主語):</b> 「食べる 魚を 猫は」 (マダガスカル語など) - <b style="color:var(--color-danger)">約3%</b></li>
                     <li>その他の語順 (OVS, OSV) はさらに稀です。</li>
                 </ul>
            </div>
            <p>UDのデータを使えば、こうした語順の地理的な分布や、言語間の関係を大規模に調査することができます。</p>
        </div>
        
     
        
        <div class="slide">
            <h2>4-2. 統語樹の実例（多言語比較）</h2>
            <div class="grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 2rem;">
                <div class="tree-container">
                    <h3>VOS言語：マダガスカル語</h3>
                    <p class="text-center font-bold">Mividy ny vary ny vehivavy.</p>
                    <p class="text-center text-sm text-slate-500">（その女性は米を買う）</p>
                    <svg class="dependency-tree" style="height:180px" viewBox="0 0 600 220">
                        <text x="100" y="150" class="dep-word">Mividy</text>
                        <text x="250" y="150" class="dep-word">ny vary</text>
                        <text x="450" y="150" class="dep-word">ny vehivavy</text>
                        <path d="M 250 135 Q 175 70 110 135" class="dep-arrow dep-obj" marker-end="url(#arrow-obj)"/><text x="175" y="90" class="dep-label dep-obj-label">obj</text>
                        <path d="M 450 135 Q 275 30 110 135" class="dep-arrow dep-nsubj" marker-end="url(#arrow-nsubj)"/><text x="275" y="60" class="dep-label dep-nsubj-label">nsubj</text>
                    </svg>
                </div>
                <div class="tree-container">
                    <h3>ラテン語 (自由語順)</h3>
                    <p class="text-center font-bold">Puella rosam amat.</p>
                    <p class="text-center text-sm text-slate-500">（少女はバラを愛する）</p>
                    <svg class="dependency-tree" style="height:180px" viewBox="0 0 500 220">
                        <text x="100" y="130" class="dep-word">Puella</text>
                        <text x="250" y="130" class="dep-word">rosam</text>
                        <text x="400" y="130" class="dep-word">amat</text>
                        <path d="M 100 115 Q 250 40 390 115" class="dep-arrow dep-nsubj" marker-end="url(#arrow-nsubj)"/><text x="250" y="65" class="dep-label dep-nsubj-label">nsubj</text>
                        <path d="M 250 115 Q 325 70 390 115" class="dep-arrow dep-obj" marker-end="url(#arrow-obj)"/><text x="325" y="90" class="dep-label dep-obj-label">obj</text>
                    </svg>
                </div>
            </div>
        </div>

          <div class="slide">
            <h2>4-3. 多言語比較：ラテン語の自由な語順</h2>
            <p>ラテン語は格変化により単語の文法的な役割が示されるため、語順を比較的自由に変えることができます。しかし、どの語順でも統語的な関係（依存関係）は変わりません。</p>
            <div class="grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 1.5rem;">
                <div class="tree-container">
                    <h3>SOV: <span class="font-normal">Puella rosam amat.</span></h3>
                    <svg class="dependency-tree" style="height:150px" viewBox="0 0 500 200">
                        <text x="100" y="130" class="dep-word">Puella</text><text x="100" y="150" class="dep-pos">少女</text>
                        <text x="250" y="130" class="dep-word">rosam</text><text x="250" y="150" class="dep-pos">バラ</text>
                        <text x="400" y="130" class="dep-word">amat</text><text x="400" y="150" class="dep-pos">愛する</text>
                        <path d="M 100 115 Q 250 40 390 115" class="dep-arrow dep-nsubj" marker-end="url(#arrow-nsubj)"/><text x="250" y="65" class="dep-label dep-nsubj-label">nsubj</text>
                        <path d="M 250 115 Q 325 70 390 115" class="dep-arrow dep-obj" marker-end="url(#arrow-obj)"/><text x="325" y="90" class="dep-label dep-obj-label">obj</text>
                    </svg>
                </div>
                <div class="tree-container">
                    <h3>SVO: <span class="font-normal">Puella amat rosam.</span></h3>
                     <svg class="dependency-tree" style="height:150px" viewBox="0 0 500 200">
                        <text x="100" y="130" class="dep-word">Puella</text><text x="100" y="150" class="dep-pos">少女</text>
                        <text x="250" y="130" class="dep-word">amat</text><text x="250" y="150" class="dep-pos">愛する</text>
                        <text x="400" y="130" class="dep-word">rosam</text><text x="400" y="150" class="dep-pos">バラ</text>
                        <path d="M 100 115 Q 175 70 240 115" class="dep-arrow dep-nsubj" marker-end="url(#arrow-nsubj)"/><text x="175" y="90" class="dep-label dep-nsubj-label">nsubj</text>
                        <path d="M 400 115 Q 325 70 260 115" class="dep-arrow dep-obj" marker-end="url(#arrow-obj)"/><text x="325" y="90" class="dep-label dep-obj-label">obj</text>
                    </svg>
                </div>
                 <div class="tree-container">
                    <h3>OVS: <span class="font-normal">Rosam amat puella.</span></h3>
                    <svg class="dependency-tree" style="height:150px" viewBox="0 0 500 200">
                        <text x="100" y="130" class="dep-word">Rosam</text><text x="100" y="150" class="dep-pos">バラ</text>
                        <text x="250" y="130" class="dep-word">amat</text><text x="250" y="150" class="dep-pos">愛する</text>
                        <text x="400" y="130" class="dep-word">puella</text><text x="400" y="150" class="dep-pos">少女</text>
                        <path d="M 100 115 Q 175 70 240 115" class="dep-arrow dep-obj" marker-end="url(#arrow-obj)"/><text x="175" y="90" class="dep-label dep-obj-label">obj</text>
                        <path d="M 400 115 Q 325 70 260 115" class="dep-arrow dep-nsubj" marker-end="url(#arrow-nsubj)"/><text x="325" y="90" class="dep-label dep-nsubj-label">nsubj</text>
                    </svg>
                </div>
            </div>
        </div>

        <div class="slide">
            <h2>4-4. 多言語比較：語順の多様性</h2>
            <div class="grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 2rem;">
                <div class="tree-container">
                    <h3>英語 (SVO)</h3>
                    <p class="text-center font-bold">I love you</p>
                    <svg class="dependency-tree" style="height:120px" viewBox="0 0 400 180">
                        <text x="80" y="120" class="dep-word" text-anchor="middle">I</text>
                        <text x="200" y="120" class="dep-word" text-anchor="middle">love</text>
                        <text x="320" y="120" class="dep-word" text-anchor="middle">you</text>
                        <path d="M 80 105 Q 140 50 190 105" class="dep-arrow dep-nsubj" marker-end="url(#arrow-nsubj)"/>
                        <text x="140" y="70" class="dep-label dep-nsubj-label" text-anchor="middle">nsubj</text>
                        <path d="M 320 105 Q 260 50 210 105" class="dep-arrow dep-obj" marker-end="url(#arrow-obj)"/>
                        <text x="260" y="70" class="dep-label dep-obj-label" text-anchor="middle">obj</text>
                    </svg>
                </div>
                <div class="tree-container">
                    <h3>アラビア語 (VSO)</h3>
                    <p class="text-center font-bold" dir="rtl">قرأ الطالب الكتاب</p>
                     <svg class="dependency-tree" style="height:120px" viewBox="0 0 400 180">
                        <text x="320" y="120" class="dep-word" text-anchor="middle">قرأ</text>
                        <text x="200" y="120" class="dep-word" text-anchor="middle">الطالب</text>
                        <text x="80" y="120" class="dep-word" text-anchor="middle">الكتاب</text>
                        <path d="M 200 105 Q 260 50 310 105" class="dep-arrow dep-nsubj" marker-end="url(#arrow-nsubj)"/>
                        <text x="260" y="70" class="dep-label dep-nsubj-label" text-anchor="middle">nsubj</text>
                        <path d="M 80 105 Q 200 50 310 105" class="dep-arrow dep-obj" marker-end="url(#arrow-obj)"/>
                        <text x="180" y="70" class="dep-label dep-obj-label" text-anchor="middle">obj</text>
                    </svg>
                </div>
            </div>
        </div>
        
     
        
        <div class="slide">
            <h2>5-1. 言語の形：形態論的類型論</h2>
            <p>言語は、単語が文法的な意味をどのように表現するかによって、いくつかのタイプに分類できます。</p>
             <div class="grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 2rem; align-items: start;">
                <div class="card">
                    <h3>孤立語 (Isolating)</h3>
                    <p>各単語がそれぞれ独立した意味を持ち、語形変化がほとんどない。例：中国語「我爱你」(wǒ ài nǐ) は「私・愛する・あなた」のように単語がそのまま並びます。</p>
                </div>
                 <div class="card">
                    <h3>膠着語 (Agglutinative)</h3>
                    <p>単語の語幹に、特定の機能を持つ接辞が次々と「糊で貼り付けるように」付いていく。例：日本語「食べさせられた」は「食べ-させ-られ-た」と分解できます。</p>
                </div>
                 <div class="card">
                    <h3>屈折語 (Inflectional)</h3>
                    <p>単語の語尾などが変化（屈折）することで、格（文における役割）、数（単数/複数）といった複数の文法情報を同時に表現します。</p>
                </div>
            </div>
            <div class="tree-container">
                <h3>屈折語の例：ラテン語の名詞 <i>rosa</i> (バラ) の格変化</h3>
                <p>同じ「バラ」という単語でも、文中での役割（「バラが」「バラの」など）によって、以下のように語尾が変化します。</p>
                <table class="styled-table">
                    <thead>
                        <tr>
                            <th>格 (Case)</th>
                            <th>単数 (Singular)</th>
                            <th>複数 (Plural)</th>
                            <th>機能の例</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>主格 (Nominative)</td>
                            <td>ros<b>a</b></td>
                            <td>ros<b>ae</b></td>
                            <td>バラ<b>が</b> (主語)</td>
                        </tr>
                        <tr>
                            <td>属格 (Genitive)</td>
                            <td>ros<b>ae</b></td>
                            <td>ros<b>ārum</b></td>
                            <td>バラ<b>の</b> (所有)</td>
                        </tr>
                        <tr>
                            <td>与格 (Dative)</td>
                            <td>ros<b>ae</b></td>
                            <td>ros<b>īs</b></td>
                            <td>バラ<b>に</b> (間接目的語)</td>
                        </tr>
                        <tr>
                            <td>対格 (Accusative)</td>
                            <td>ros<b>am</b></td>
                            <td>ros<b>ās</b></td>
                            <td>バラ<b>を</b> (直接目的語)</td>
                        </tr>
                        <tr>
                            <td>奪格 (Ablative)</td>
                            <td>ros<b>ā</b></td>
                            <td>ros<b>īs</b></td>
                            <td>バラ<b>によって</b> (手段・場所など)</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
       
        <div class="slide">
            <h2>6. 研究例：危機言語と古代言語</h2>
            <div class="grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 2rem;">
                <div class="tree-container">
                    <h3>危機言語: 沖縄語</h3>
                    <p class="text-center font-bold">わんねー ちゅーや 学校んかい 行ちゅん</p>
                     <svg class="dependency-tree" style="height:180px" viewBox="0 0 700 220">
                        <text x="80" y="150" class="dep-word" text-anchor="middle">わんねー</text>
                        <text x="220" y="150" class="dep-word" text-anchor="middle">ちゅーや</text>
                        <text x="380" y="150" class="dep-word" text-anchor="middle">学校</text>
                        <text x="500" y="150" class="dep-word" text-anchor="middle">んかい</text>
                        <text x="620" y="150" class="dep-word" text-anchor="middle">行ちゅん</text>
                        <path d="M 80 135 Q 350 30 610 135" class="dep-arrow dep-nsubj" marker-end="url(#arrow-nsubj)"/><text x="350" y="55" class="dep-label dep-nsubj-label">nsubj</text>
                        <path d="M 220 135 Q 420 70 610 135" class="dep-arrow dep-mod" marker-end="url(#arrow-mod)"/><text x="420" y="95" class="dep-label dep-mod-label">obl</text>
                        <path d="M 380 135 Q 500 80 610 135" class="dep-arrow dep-mod" marker-end="url(#arrow-mod)"/><text x="500" y="105" class="dep-label dep-mod-label">obl</text>
                        <path d="M 500 135 Q 440 105 390 135" class="dep-arrow dep-case" marker-end="url(#arrow-case)"/>
                    </svg>
                </div>
                <div class="tree-container">
                    <h3>古代言語: コプト語</h3>
                    <p class="text-center font-bold">ⲁϥⲥⲱⲧⲙ ⲛϭⲓ ⲡⲣⲱⲙⲉ</p>
                    <svg class="dependency-tree" style="height:180px" viewBox="0 0 600 220">
                         <text x="100" y="150" class="dep-word" text-anchor="middle">ⲁϥⲥⲱⲧⲙ</text>
                         <text x="300" y="150" class="dep-word" text-anchor="middle">ⲛϭⲓ</text>
                         <text x="500" y="150" class="dep-word" text-anchor="middle">ⲡⲣⲱⲙⲉ</text>
                         <path d="M 500 135 Q 300 60 110 135" class="dep-arrow dep-nsubj" marker-end="url(#arrow-nsubj)"/><text x="300" y="80" class="dep-label dep-nsubj-label">nsubj</text>
                         <path d="M 300 135 Q 400 100 490 135" class="dep-arrow dep-case" marker-end="url(#arrow-case)"/>
                    </svg>
                </div>
            </div>
        </div>
        
        <div class="slide">
            <h2>7. 便利なツール</h2>
            <p>これらのツールはすべて無料で、ブラウザから直接利用できます。プログラミングの知識は必要ありません。</p>
            <div class="grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 2rem;">
                <div class="card" style="text-align: center;">
                    <i class="fas fa-globe-asia" style="font-size: 2.5rem; color: var(--color-primary); margin-bottom: 1rem;"></i>
                    <h3>UDPipe</h3>
                    <p>テキストを貼り付けるだけで、100以上の言語を自動で構文解析します。</p>
                    <a href="https://lindat.mff.cuni.cz/services/udpipe/" target="_blank" style="font-weight: bold; color: var(--color-primary);">試してみる &rarr;</a>
                </div>
                <div class="card" style="text-align: center;">
                    <i class="fas fa-pen-ruler" style="font-size: 2.5rem; color: var(--color-secondary); margin-bottom: 1rem;"></i>
                    <h3>ArboratorGrew</h3>
                    <p>統語樹を直感的に編集したり、特定の文法パターンを検索したりできます。</p>
                    <a href="https://arborator.github.io/arborator-grew/" target="_blank" style="font-weight: bold; color: var(--color-secondary);">試してみる &rarr;</a>
                </div>
                <div class="card" style="text-align: center;">
                    <i class="fas fa-search-location" style="font-size: 2.5rem; color: var(--color-success); margin-bottom: 1rem;"></i>
                    <h3>UD Treebank Search</h3>
                    <p>世界中のUDツリーバンクから、特定の単語や構造を横断的に検索できます。</p>
                     <a href="https://universaldependencies.org/search.html" target="_blank" style="font-weight: bold; color: var(--color-success);">試してみる &rarr;</a>
                </div>
            </div>
        </div>

        <div class="slide">
            <h2>8-1. AIと創る研究テーマ</h2>
            <p>あなたの興味をAIに伝え、新しい研究の種を見つけましょう。</p>
            <div id="api-key-setup-1" class="card" style="display: none; border-color: var(--color-accent);">
                <h3 style="color: var(--color-accent);">AI機能の利用にはAPIキーが必要です</h3>
                <p style="font-size:1rem;">このAI機能はGoogleのGemini APIを使用しています。GitHub Pages等で機能を有効にするには、ご自身のAPIキーを入力してください。</p>
                <div style="display: flex; gap: 1rem; align-items: center; margin-top: 1rem;">
                    <input type="password" class="api-key-input" placeholder="ここにGemini APIキーを貼り付け" style="flex-grow: 1; padding: 0.75rem; border: 1px solid var(--color-border); border-radius: 8px; font-size: 1rem;">
                    <button class="save-api-key-btn gemini-button" style="background: var(--color-accent);">保存</button>
                </div>
                <p style="font-size: 0.9rem; margin-top: 1rem;">APIキーは<a href="https://aistudio.google.com/app/apikey" target="_blank" style="color: var(--color-primary); text-decoration: underline;">Google AI Studio</a>から無料で取得できます。入力されたキーはブラウザのローカルストレージにのみ保存されます。</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="research-topics-container">
                 <div class="card"><h3 class="text-xl">📱 SNSの言葉遣い</h3><p>「それな」「マジ卍」といった流行語が、文中でどのような文法的な役割を担っているかを分析する。</p></div>
                 <div class="card"><h3 class="text-xl">🎮 ゲーム・アニメのキャラ言語</h3><p>特定のキャラクターの口癖や話し方の統語的な特徴を明らかにする。</p></div>
            </div>
            <div class="text-center mt-8">
                <button id="generate-topics-btn" class="gemini-button">
                    <i class="fas fa-magic"></i> 新しい研究テーマをAIに提案してもらう
                </button>
            </div>
            <div id="topics-loader" class="text-center mt-4" style="display: none;">AIが考えています...</div>
        </div>
        
        <div class="slide">
            <h2>8-2. AI構文分析ラボ</h2>
             <div id="api-key-setup-2" class="card" style="display: none; border-color: var(--color-accent);">
                <h3 style="color: var(--color-accent);">AI機能の利用にはAPIキーが必要です</h3>
                <p style="font-size:1rem;">このAI機能はGoogleのGemini APIを使用しています。GitHub Pages等で機能を有効にするには、ご自身のAPIキーを入力してください。</p>
                <div style="display: flex; gap: 1rem; align-items: center; margin-top: 1rem;">
                    <input type="password" class="api-key-input" placeholder="ここにGemini APIキーを貼り付け" style="flex-grow: 1; padding: 0.75rem; border: 1px solid var(--color-border); border-radius: 8px; font-size: 1rem;">
                    <button class="save-api-key-btn gemini-button" style="background: var(--color-accent);">保存</button>
                </div>
                <p style="font-size: 0.9rem; margin-top: 1rem;">APIキーは<a href="https://aistudio.google.com/app/apikey" target="_blank" style="color: var(--color-primary); text-decoration: underline;">Google AI Studio</a>から無料で取得できます。入力されたキーはブラウザのローカルストレージにのみ保存されます。</p>
            </div>
             <div class="card">
                <h3>分析したい日本語の文章を入力してください</h3>
                <textarea id="sentence-input" rows="3" class="w-full p-3 border border-gray-300 rounded-xl text-lg" style="border-color: var(--color-border);" placeholder="例：隣の客はよく柿食う客だ"></textarea>
                <div class="text-center mt-4">
                    <button id="analyze-sentence-btn" class="gemini-button">
                        <i class="fas fa-brain"></i> この文章をAIに分析・描画させる
                    </button>
                </div>
            </div>
            <div id="analysis-result" class="mt-6"></div>
        </div>
        
        <div class="slide">
            <h2>8-3. AI言語横断ラボ</h2>
             <div id="api-key-setup-3" class="card" style="display: none; border-color: var(--color-accent);">
                <h3 style="color: var(--color-accent);">AI機能の利用にはAPIキーが必要です</h3>
                <p style="font-size:1rem;">このAI機能はGoogleのGemini APIを使用しています。GitHub Pages等で機能を有効にするには、ご自身のAPIキーを入力してください。</p>
                <div style="display: flex; gap: 1rem; align-items: center; margin-top: 1rem;">
                    <input type="password" class="api-key-input" placeholder="ここにGemini APIキーを貼り付け" style="flex-grow: 1; padding: 0.75rem; border: 1px solid var(--color-border); border-radius: 8px; font-size: 1rem;">
                    <button class="save-api-key-btn gemini-button" style="background: var(--color-accent);">保存</button>
                </div>
                <p style="font-size: 0.9rem; margin-top: 1rem;">APIキーは<a href="https://aistudio.google.com/app/apikey" target="_blank" style="color: var(--color-primary); text-decoration: underline;">Google AI Studio</a>から無料で取得できます。入力されたキーはブラウザのローカルストレージにのみ保存されます。</p>
            </div>
            <div class="card">
                 <h3>日本語の文章を入力し、比較したい言語を選んでください</h3>
                 <div class="grid" style="display:grid; grid-template-columns: 1fr auto; gap: 1rem; align-items: center;">
                    <input id="cross-lingual-input" type="text" class="w-full p-3 border rounded-lg text-lg" style="border-color: var(--color-border);" placeholder="例：猫が魚を食べる">
                    <select id="target-lang-select" class="p-3 border rounded-lg text-lg" style="border-color: var(--color-border); background-color: white;">
                        <option value="English">英語</option>
                        <option value="Latin">ラテン語</option>
                    </select>
                 </div>
                 <div class="text-center mt-4">
                    <button id="cross-lingual-btn" class="gemini-button">
                        <i class="fas fa-exchange-alt"></i> 翻訳して統語構造を比較する
                    </button>
                </div>
            </div>
            <div id="cross-lingual-result" class="mt-6"></div>
        </div>


        <div class="slide">
             <h2>9. まとめと質疑応答</h2>
             <div class="card">
                <h3>本日のまとめ</h3>
                 <ul class="list-disc list-inside space-y-2">
                     <li>UDは、言語の壁を越えて文法構造を比較できる<strong>共通の物差し</strong>です。</li>
                     <li>統語樹は、単語間の<strong>依存関係</strong>を可視化します。</li>
                     <li><strong>無料のツール</strong>と<strong>生成AI</strong>を組み合わせることで、誰でも高度な言語分析を始められます。</li>
                 </ul>
            </div>
            <div class="text-center mt-12">
                 <h1 style="color:var(--color-primary)">ご清聴ありがとうございました</h1>
                 <p class="text-2xl">ご質問をお待ちしております。</p>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const slides = Array.from(document.querySelectorAll('.slide'));
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            const currentNumEl = document.getElementById('current-slide-num');
            const totalNumEl = document.getElementById('total-slides-num');
            const progressFill = document.getElementById('progress-fill');
            const generateTopicsBtn = document.getElementById('generate-topics-btn');
            const topicsContainer = document.getElementById('research-topics-container');
            const topicsLoader = document.getElementById('topics-loader');
            const analyzeSentenceBtn = document.getElementById('analyze-sentence-btn');
            const sentenceInput = document.getElementById('sentence-input');
            const analysisResult = document.getElementById('analysis-result');
            const crossLingualBtn = document.getElementById('cross-lingual-btn');
            const crossLingualInput = document.getElementById('cross-lingual-input');
            const targetLangSelect = document.getElementById('target-lang-select');
            const crossLingualResult = document.getElementById('cross-lingual-result');
            
            const geminiApiKeyName = 'gemini-api-key';
            let current = 0;
            totalNumEl.textContent = slides.length;

            const callGemini = async (prompt) => {
                const apiKey = localStorage.getItem(geminiApiKeyName);
                if (!apiKey) {
                    return JSON.stringify({ error: "Gemini APIキーが設定されていません。" });
                }
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }] };
                try {
                    const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                    if (!response.ok) throw new Error(`API request failed with status ${response.status}`);
                    const result = await response.json();
                    if (result.candidates && result.candidates[0].content && result.candidates[0].content.parts) {
                        return result.candidates[0].content.parts[0].text;
                    }
                    return JSON.stringify({ error: "AIからの応答がありませんでした。" });
                } catch (error) {
                    return JSON.stringify({ error: `AIとの通信中にエラーが発生しました: ${error.message}`});
                }
            };

            const saveApiKey = (event) => {
                const input = event.target.closest('div').querySelector('.api-key-input');
                const key = input.value.trim();
                 if (key) {
                    localStorage.setItem(geminiApiKeyName, key);
                    checkAndSetupApi();
                } else {
                    alert('APIキーを入力してください。');
                }
            };

            const checkAndSetupApi = () => {
                const apiKey = localStorage.getItem(geminiApiKeyName);
                const aiButtons = [generateTopicsBtn, analyzeSentenceBtn, crossLingualBtn];
                const setupDivs = [document.getElementById('api-key-setup-1'), document.getElementById('api-key-setup-2'), document.getElementById('api-key-setup-3')];

                if (apiKey) {
                    aiButtons.forEach(btn => { if(btn) btn.disabled = false; });
                    setupDivs.forEach(div => { if(div) div.style.display = 'none'; });
                } else {
                    aiButtons.forEach(btn => { if(btn) btn.disabled = true; });
                    setupDivs.forEach(div => { if(div) div.style.display = 'block'; });
                }
            };
            
            document.querySelectorAll('.save-api-key-btn').forEach(button => button.addEventListener('click', saveApiKey));

            generateTopicsBtn.addEventListener('click', async () => {
                generateTopicsBtn.disabled = true;
                topicsLoader.style.display = 'block';
                const prompt = 'あなたは言語学の教授です。Universal Dependencies (UD) を活用した、高校生や大学生でも探求できるような、斬新で面白い研究テーマを2つ提案してください。テーマは箇条書きで、それぞれに簡単な説明を加えてください。';
                const resultText = await callGemini(prompt);
                
                topicsContainer.innerHTML = '';
                const topics = resultText.split(/\n\s*[\*|-]\s*/).filter(t => t && t.trim());
                
                topics.forEach(topic => {
                    const card = document.createElement('div');
                    card.className = 'card';
                    const cleanedTopic = topic.trim();
                    const titleMatch = cleanedTopic.match(/^(.*?):/);
                    card.innerHTML = titleMatch ? '<h3 class="text-xl">' + titleMatch[1] + '</h3><p>' + cleanedTopic.substring(titleMatch[0].length).trim() + '</p>' : '<p>' + cleanedTopic + '</p>';
                    topicsContainer.appendChild(card);
                });
                
                generateTopicsBtn.disabled = false;
                topicsLoader.style.display = 'none';
            });
            
            analyzeSentenceBtn.addEventListener('click', async () => {
                const sentence = sentenceInput.value.trim();
                if (!sentence) {
                    analysisResult.innerHTML = '<p class="text-red-500">分析する文章を入力してください。</p>';
                    return;
                }
                analyzeSentenceBtn.disabled = true;
                analysisResult.innerHTML = '<div class="text-center">AIが分析・描画中です...</div>';
                
                const prompt = `あなたは日本語の統語構造の専門家です。文「${sentence}」を分析し、以下のJSON形式で応答してください。
                {
                  "analysis": { "explanation": "この文の構造に関する50字程度の解説" },
                  "svg": "統語樹のSVGコード文字列。viewBox='0 0 単語数*120 200' とし、各単語のx座標は 100, 220, 340... としてください。依存関係のpathとtextには、役割に応じたクラス（dep-nsubj, dep-obj, dep-mod, dep-caseとdep-nsubj-label, dep-obj-labelなど）とmarker-end属性を必ず付けてください。"
                }`;

                const resultText = await callGemini(prompt);
                
                try {
                    const result = JSON.parse(resultText.replace(/^```json\n?/, '').replace(/```$/, '').trim());
                    if (result.error) throw new Error(result.error);
                    
                    const { analysis, svg } = result;
                    const html = '<div class="tree-container">' +
                        '<h3 class="text-xl">AIによる構文分析結果</h3>' +
                        (svg || '<p>SVGの生成に失敗しました。</p>') +
                        '<div class="highlight-card mt-6">' +
                        '<p><strong>AIによる解説:</strong> ' + (analysis.explanation || '解説を生成できませんでした。') + '</p>' +
                        '</div>' +
                        '</div>';
                    analysisResult.innerHTML = html;
                } catch (e) {
                    analysisResult.innerHTML = '<div class="card" style="border-color:red;"><h3 class="text-red-500">分析エラー</h3><p>AIからの応答を解析できませんでした。</p><pre style="white-space:pre-wrap; word-break:break-all; background:#eee; padding:1rem; border-radius:8px;">' + resultText + '</pre></div>';
                }
                
                analyzeSentenceBtn.disabled = false;
            });

            crossLingualBtn.addEventListener('click', async () => {
                const sentence = crossLingualInput.value.trim();
                if (!sentence) {
                    crossLingualResult.innerHTML = '<p class="text-red-500">分析する日本語の文章を入力してください。</p>';
                    return;
                }
                const targetLang = targetLangSelect.value;

                crossLingualBtn.disabled = true;
                crossLingualResult.innerHTML = '<div class="text-center">AIが翻訳・分析・描画中です...</div>';

                const prompt = `
                    あなたは多言語の統語構造に詳しい専門家です。
                    以下の日本語の文を、指定されたターゲット言語に翻訳し、両方の文の統語構造を分析してください。
                    応答はJSON形式のみとし、マークダウンのコードブロックは含めないでください。

                    # 指示
                    - 日本語の文: "${sentence}"
                    - ターゲット言語: ${targetLang}
                    - 応答JSONは "original" と "translated" の2つのキーを持つこと。
                    - 各キーの値は、文（sentence）、解説（explanation）、統語樹SVG（svg）を含むオブジェクトとすること。
                    - SVGは適切に色分けされたクラスとmarker-end属性を適用すること。

                    # JSON出力形式
                    {
                      "original": {
                        "sentence": "元の日本語文",
                        "explanation": "日本語文の構造解説",
                        "svg": "<svg>...</svg>"
                      },
                      "translated": {
                        "sentence": "翻訳された文",
                        "explanation": "翻訳された文の構造解説",
                        "svg": "<svg>...</svg>"
                      }
                    }
                `;

                const resultText = await callGemini(prompt);

                 try {
                    const result = JSON.parse(resultText.replace(/^```json\n?/, '').replace(/```$/, '').trim());
                    if (result.error) throw new Error(result.error);
                    
                    const { original, translated } = result;
                    const html = '<div class="grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 2rem;">' +
                        '<div class="tree-container">' +
                            '<h3>日本語（原文）</h3>' +
                            '<p class="text-center font-bold">' + (original.sentence || "") + '</p>' +
                            (original.svg || '<p>SVGの生成に失敗</p>') +
                            '<p style="font-size:1rem;">' + (original.explanation || "") + '</p>' +
                        '</div>' +
                        '<div class="tree-container">' +
                            '<h3>' + targetLang + '（翻訳）</h3>' +
                            '<p class="text-center font-bold">' + (translated.sentence || "") + '</p>' +
                            (translated.svg || '<p>SVGの生成に失敗</p>') +
                            '<p style="font-size:1rem;">' + (translated.explanation || "") + '</p>' +
                        '</div>' +
                    '</div>';
                    crossLingualResult.innerHTML = html;
                } catch (e) {
                    crossLingualResult.innerHTML = '<div class="card" style="border-color:red;"><h3 class="text-red-500">分析エラー</h3><p>AIからの応答を解析できませんでした。</p><pre style="white-space:pre-wrap; word-break:break-all; background:#eee; padding:1rem; border-radius:8px;">' + resultText + '</pre></div>';
                }

                crossLingualBtn.disabled = false;
            });

            const showSlide = (index) => {
                slides.forEach((slide, i) => {
                    slide.classList.remove('active', 'prev-slide');
                    if (i === index) slide.classList.add('active');
                    else if (i < index) slide.classList.add('prev-slide');
                });
                current = index;
                updateUI();
            };

            const updateUI = () => {
                currentNumEl.textContent = current + 1;
                progressFill.style.width = `${((current + 1) / slides.length) * 100}%`;
                prevBtn.disabled = current === 0;
                nextBtn.disabled = current === slides.length - 1;
            };

            const next = () => { if (current < slides.length - 1) showSlide(current + 1); };
            const prev = () => { if (current > 0) showSlide(current - 1); };

            nextBtn.addEventListener('click', next);
            prevBtn.addEventListener('click', prev);
            document.addEventListener('keydown', (e) => {
                if (document.activeElement.tagName === 'TEXTAREA') return;
                if (e.key === 'ArrowRight' || e.key === ' ') { e.preventDefault(); next(); } 
                else if (e.key === 'ArrowLeft') { e.preventDefault(); prev(); }
            });
            checkAndSetupApi();
            showSlide(0);
        });
    </script>
</body>
</html>